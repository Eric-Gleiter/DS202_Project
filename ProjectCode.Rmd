---
title: "Final Project"
author: "Eric Gleiter, Anyesha Ray, Brandon Xicon, Mckenna Goffinet"
date: "4/6/2020"
output: html_document
---

**PLACE HOLDER FOR NOW**
```{r}
if (!require("tidyverse")) {
install.packages("tidyverse")
}
if (!require("openintro")) {
install.packages("openintro")
}
if (!require("lubridate")) {
install.packages("lubridate")
}
if (!require("maps")) {
install.packages("maps")
}
if (!require("plotly")) {
install.packages("plotly")
}
library(plotly)
library(tidyverse)
library(openintro) #used to quickly switch state names and abbrevations
library(maps)
library(lubridate)
```


```{r}
#Takes a long time to run would recommmend only running once  
severityDS <- read.csv("Severity.csv")
start_timeDS <- read.csv("Start_Time.csv")
end_timeDS <- read.csv("End_Time.csv")
latDS <- read.csv("Start_Lat.csv")
longDS <- read.csv("Start_Lng.csv")
cityDS <- read.csv("City.csv")
countyDS <- read.csv("County.csv")
stateDS <- read.csv("State.csv")
tempDS <- read.csv("Temperature.csv")
windDS <- read.csv("Wind_Speed.csv")
visibiltyDS <- read.csv( "Visibilty.csv")
startDayDS <- read.csv("Start_Day.csv")
startYearDS <- read.csv("Start_Year.csv")
startMonthDS <- read.csv("Start_Month.csv")
endDayDS <- read.csv("End_Day.csv")
endYearDS <- read.csv("End_Year.csv")
endMonthDS <- read.csv("End_Month.csv")
```

```{r}
#Joins all the data together will add more if we need more columns
#Takes a long time to run would recommmend only running once  
fullData <- severityDS %>%
  inner_join(start_timeDS) %>%
  inner_join(end_timeDS) %>%
  inner_join(latDS) %>%
  inner_join(longDS) %>%
  inner_join(cityDS) %>%
  inner_join(countyDS) %>%
  inner_join(stateDS) %>%
  inner_join(tempDS) %>%
  inner_join(windDS) %>%
  inner_join(visibiltyDS) %>%
  inner_join(startMonthDS) %>%
  inner_join(startYearDS) %>%
  inner_join(startDayDS) %>%
  inner_join(endYearDS) %>%
  inner_join(endDayDS) %>%
  inner_join(endMonthDS) %>%
  select(-X) #deletes a column that is row number
```

```{r}
#use a sub set of the data to test things
Iowa <- fullData %>%
  filter(State == "IA")
```


```{r}
#plots the mean severity in every county in the us altough it appears some counites are missing
fullCounties <- map_data("county")


fullMapData <- fullData %>% 
  mutate(region = tolower(abbr2state(State))) %>%
  mutate(subregion = tolower(County)) %>%
  select(region, subregion,Severity) %>%
  group_by(region,subregion) %>%
  summarise(meanSeverity = mean(Severity)) %>%
  right_join(fullCounties,by=c("region","subregion"))

ggplot(fullMapData, aes(x=long,y=lat,fill = meanSeverity))+
  geom_polygon(aes(group=group)) +
  labs(x="Longitude",y="Latitude",title = "Severity of Accidents in US by County")

```

```{r}
#The following reconverts all the date and time columns back together and get a numeric duration for the accident
Full_Duration <- fullData %>%
  unite(col = "Start_Date", c(Start_Year,Start_Month,Start_Day),sep = "-") %>%
  unite(col = "FullStart_Time", c(Start_Date,Start_Time),sep = " ") %>%
  unite(col = "End_Date", c(End_Year,End_Month,End_Day),sep = "-") %>%
  unite(col = "FullEnd_Time", c(End_Date,End_Time),sep = " ") %>%
  mutate(duration = as.double(as.duration(interval(ymd_hms(FullStart_Time),ymd_hms(FullEnd_Time))))) #num of seconds of the accident


ggplot(Full_Duration,aes(x=Severity, y=duration)) +
  geom_point()

```


```{r}
#decided to get rid of he data from 2016,2015 and 2020 in order to have data that includes full years as before the 2016 data starts in february which means january will be underrepresented
time<-fullData %>%
  filter(Start_Year!=2016)%>%
  filter(Start_Year!=2015)%>%
  filter(Start_Year!=2020)%>%
  unite(col = "Start_Date2", c(Start_Year,Start_Day,Start_Month),sep = "-",remove=FALSE)%>%
  group_by(Start_Date2) %>%
  mutate(dayCount = n())
ggplot(time,aes(x=Start_Month))+geom_bar()+labs(x="Month",title = "Frequency of accidents by month")+ scale_x_continuous(name = " ", breaks = c(1,2,3,4,5,6,7,8,9,10,11,12))
```


# ```{r}
# time<-time %>%
#   distinct(Start_Date2,.keep_all = TRUE)
# time
# plot_ly(time,x=~Start_Day, y=~Start_Month,z=~Start_Year,type='scatter3d',mode='markers',color=~dayCount)
# ```


```{r}
graph<-ggplot(time,aes(x=time$Start_Month, y=time$Start_Day,color=time$dayCount))+facet_wrap(time$Start_Year)+geom_point()+ scale_x_continuous(name = " ", breaks = c(1,2,3,4,5,6,7,8,9,10,11,12))+labs(x="Month",y="Day",color="Count")+ scale_colour_gradientn(colours = terrain.colors(10))
ggplotly(graph)
```

```{r}

time$Severity<-as.factor(time$Severity)
time$day<-ydm(time$Start_Date2)

```

```{r}
graph<-ggplot()+geom_line(aes(x=time$day,y=time$dayCount,color="Count vs Day"
                              #,color=time$Severity
                              ),data = time,stat = "identity")+labs(x="Month",y="Count")+geom_smooth()#+

#scale_color_manual(values = c(""))

ggplotly(graph)
```